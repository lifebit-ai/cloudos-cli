<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.07.19 -->
        <title>cloudos_cli.clos - CloudOS CLI Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=25af2a20" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">CloudOS CLI Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <span class="sidebar-brand-text">CloudOS CLI Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html#cloudos-cli">cloudos-cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html">CLI Reference</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../modules.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.html">cloudos_cli</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of cloudos_cli</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/cloudos_cli.clos.html">cloudos_cli.clos</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.configure.html">cloudos_cli.configure</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of cloudos_cli.configure</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/cloudos_cli.configure.configure.html">cloudos_cli.configure.configure</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.cost.html">cloudos_cli.cost</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of cloudos_cli.cost</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/cloudos_cli.cost.cost.html">cloudos_cli.cost.cost</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.datasets.html">cloudos_cli.datasets</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of cloudos_cli.datasets</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/cloudos_cli.datasets.datasets.html">cloudos_cli.datasets.datasets</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.import_wf.html">cloudos_cli.import_wf</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of cloudos_cli.import_wf</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/cloudos_cli.import_wf.import_wf.html">cloudos_cli.import_wf.import_wf</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.jobs.html">cloudos_cli.jobs</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of cloudos_cli.jobs</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/cloudos_cli.jobs.job.html">cloudos_cli.jobs.job</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.link.html">cloudos_cli.link</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of cloudos_cli.link</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/cloudos_cli.link.link.html">cloudos_cli.link.link</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.logging.html">cloudos_cli.logging</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of cloudos_cli.logging</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/cloudos_cli.logging.logger.html">cloudos_cli.logging.logger</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.procurement.html">cloudos_cli.procurement</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of cloudos_cli.procurement</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/cloudos_cli.procurement.images.html">cloudos_cli.procurement.images</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.queue.html">cloudos_cli.queue</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of cloudos_cli.queue</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/cloudos_cli.queue.queue.html">cloudos_cli.queue.queue</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.html">cloudos_cli.utils</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of cloudos_cli.utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.array_job.html">cloudos_cli.utils.array_job</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.cloud.html">cloudos_cli.utils.cloud</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.details.html">cloudos_cli.utils.details</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.errors.html">cloudos_cli.utils.errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.last_wf.html">cloudos_cli.utils.last_wf</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.requests.html">cloudos_cli.utils.requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.resources.html">cloudos_cli.utils.resources</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/cloudos_cli._version.html">cloudos_cli._version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/cloudos_cli.clos.html">cloudos_cli.clos</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.configure.html">cloudos_cli.configure</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of cloudos_cli.configure</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/cloudos_cli.configure.configure.html">cloudos_cli.configure.configure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/cloudos_cli.configure.configure.html">cloudos_cli.configure.configure</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.datasets.html">cloudos_cli.datasets</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of cloudos_cli.datasets</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/cloudos_cli.datasets.datasets.html">cloudos_cli.datasets.datasets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/cloudos_cli.datasets.datasets.html">cloudos_cli.datasets.datasets</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.import_wf.html">cloudos_cli.import_wf</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of cloudos_cli.import_wf</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/cloudos_cli.import_wf.import_wf.html">cloudos_cli.import_wf.import_wf</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/cloudos_cli.import_wf.import_wf.html">cloudos_cli.import_wf.import_wf</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.jobs.html">cloudos_cli.jobs</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of cloudos_cli.jobs</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/cloudos_cli.jobs.job.html">cloudos_cli.jobs.job</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/cloudos_cli.jobs.job.html">cloudos_cli.jobs.job</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.link.html">cloudos_cli.link</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of cloudos_cli.link</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/cloudos_cli.link.link.html">cloudos_cli.link.link</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/cloudos_cli.link.link.html">cloudos_cli.link.link</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.procurement.html">cloudos_cli.procurement</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of cloudos_cli.procurement</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/cloudos_cli.procurement.images.html">cloudos_cli.procurement.images</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/cloudos_cli.procurement.images.html">cloudos_cli.procurement.images</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.queue.html">cloudos_cli.queue</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of cloudos_cli.queue</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/cloudos_cli.queue.queue.html">cloudos_cli.queue.queue</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/cloudos_cli.queue.queue.html">cloudos_cli.queue.queue</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.html">cloudos_cli.utils</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of cloudos_cli.utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.array_job.html">cloudos_cli.utils.array_job</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.cloud.html">cloudos_cli.utils.cloud</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.details.html">cloudos_cli.utils.details</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.errors.html">cloudos_cli.utils.errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.last_wf.html">cloudos_cli.utils.last_wf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.requests.html">cloudos_cli.utils.requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.resources.html">cloudos_cli.utils.resources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.array_job.html">cloudos_cli.utils.array_job</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.cloud.html">cloudos_cli.utils.cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.details.html">cloudos_cli.utils.details</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.errors.html">cloudos_cli.utils.errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.last_wf.html">cloudos_cli.utils.last_wf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.requests.html">cloudos_cli.utils.requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../_autosummary/cloudos_cli.utils.resources.html">cloudos_cli.utils.resources</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for cloudos_cli.clos</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This is the main class of the package.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cloudos_cli.utils.cloud</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_cloud</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cloudos_cli.utils.errors</span><span class="w"> </span><span class="kn">import</span> <span class="n">BadRequestException</span><span class="p">,</span> <span class="n">JoBNotCompletedException</span><span class="p">,</span> <span class="n">NotAuthorisedException</span><span class="p">,</span> <span class="n">JobAccessDeniedException</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cloudos_cli.utils.requests</span><span class="w"> </span><span class="kn">import</span> <span class="n">retry_requests_get</span><span class="p">,</span> <span class="n">retry_requests_post</span><span class="p">,</span> <span class="n">retry_requests_put</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cloudos_cli.utils.last_wf</span><span class="w"> </span><span class="kn">import</span> <span class="n">youngest_workflow_id_by_name</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>


<span class="c1"># GLOBAL VARS</span>
<span class="n">JOB_COMPLETED</span> <span class="o">=</span> <span class="s1">&#39;completed&#39;</span>
<span class="n">JOB_FAILED</span> <span class="o">=</span> <span class="s1">&#39;failed&#39;</span>
<span class="n">JOB_ABORTED</span> <span class="o">=</span> <span class="s1">&#39;aborted&#39;</span>


<div class="viewcode-block" id="Cloudos">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Cloudos</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A simple class to contain the required connection information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cloudos_url : string</span>
<span class="sd">        The CloudOS service url.</span>
<span class="sd">    apikey : string</span>
<span class="sd">        Your CloudOS API key.</span>
<span class="sd">    cromwell_token : string</span>
<span class="sd">        Cromwell server token. If None, apikey will be used instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cloudos_url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">apikey</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">cromwell_token</span><span class="p">:</span> <span class="nb">str</span>

<div class="viewcode-block" id="Cloudos.get_job_status">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.get_job_status">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_job_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">j_id</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get job status from CloudOS.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        j_id : string</span>
<span class="sd">            The CloudOS job id of the job just launched.</span>
<span class="sd">        verify: [bool|string]</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        r : requests.models.Response</span>
<span class="sd">            The server response</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cloudos_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span>
        <span class="n">apikey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="n">apikey</span>
        <span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/api/v1/jobs/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cloudos_url</span><span class="p">,</span>
                                                          <span class="n">j_id</span><span class="p">),</span>
                               <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span></div>


<div class="viewcode-block" id="Cloudos.wait_job_completion">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.wait_job_completion">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">wait_job_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span> <span class="n">request_interval</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks job status from CloudOS and wait for its complation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        j_id : string</span>
<span class="sd">            The CloudOS job id of the job just launched.</span>
<span class="sd">        wait_time : int</span>
<span class="sd">            Max time to wait (in seconds) to job completion.</span>
<span class="sd">        request_interval : int</span>
<span class="sd">            Time interval (in seconds) to request job status.</span>
<span class="sd">        verbose : bool</span>
<span class="sd">            Whether to output status on every request or not.</span>
<span class="sd">        verify: [bool|string]</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        : dict</span>
<span class="sd">            A dict with three elements collected from the job status: &#39;name&#39;, &#39;id&#39;, &#39;status&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">j_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="si">}</span><span class="s1">/app/advanced-analytics/analyses/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">j_status_h_old</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1"># make sure user doesn&#39;t surpass the wait time</span>
        <span class="k">if</span> <span class="n">request_interval</span> <span class="o">&gt;</span> <span class="n">wait_time</span><span class="p">:</span>
            <span class="n">request_interval</span> <span class="o">=</span> <span class="n">wait_time</span>
        <span class="k">while</span> <span class="n">elapsed</span> <span class="o">&lt;</span> <span class="n">wait_time</span><span class="p">:</span>
            <span class="n">j_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">verify</span><span class="p">)</span>
            <span class="n">j_status_content</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j_status</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="n">j_status_h</span> <span class="o">=</span> <span class="n">j_status_content</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>
            <span class="n">j_name</span> <span class="o">=</span> <span class="n">j_status_content</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">j_status_h</span> <span class="o">==</span> <span class="n">JOB_COMPLETED</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Your job &quot;</span><span class="si">{</span><span class="n">j_name</span><span class="si">}</span><span class="s1">&quot; (ID: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s1">) took </span><span class="si">{</span><span class="n">elapsed</span><span class="si">}</span><span class="s1"> seconds to complete &#39;</span> <span class="o">+</span>
                          <span class="s1">&#39;successfully.&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">j_name</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">job_id</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">j_status_h</span><span class="p">}</span>
            <span class="k">elif</span> <span class="n">j_status_h</span> <span class="o">==</span> <span class="n">JOB_FAILED</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Your job &quot;</span><span class="si">{</span><span class="n">j_name</span><span class="si">}</span><span class="s1">&quot; (ID: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s1">) took </span><span class="si">{</span><span class="n">elapsed</span><span class="si">}</span><span class="s1"> seconds to fail.&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">j_name</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">job_id</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">j_status_h</span><span class="p">}</span>
            <span class="k">elif</span> <span class="n">j_status_h</span> <span class="o">==</span> <span class="n">JOB_ABORTED</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Your job &quot;</span><span class="si">{</span><span class="n">j_name</span><span class="si">}</span><span class="s1">&quot; (ID: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s1">) took </span><span class="si">{</span><span class="n">elapsed</span><span class="si">}</span><span class="s1"> seconds to abort.&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">j_name</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">job_id</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">j_status_h</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">elapsed</span> <span class="o">+=</span> <span class="n">request_interval</span>
                <span class="k">if</span> <span class="n">j_status_h</span> <span class="o">!=</span> <span class="n">j_status_h_old</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Your current job &quot;</span><span class="si">{</span><span class="n">j_name</span><span class="si">}</span><span class="s1">&quot; (ID: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s1">) status is: </span><span class="si">{</span><span class="n">j_status_h</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
                    <span class="n">j_status_h_old</span> <span class="o">=</span> <span class="n">j_status_h</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">request_interval</span><span class="p">)</span>
        <span class="n">j_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">verify</span><span class="p">)</span>
        <span class="n">j_status_content</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j_status</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">j_status_h</span> <span class="o">=</span> <span class="n">j_status_content</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>
        <span class="n">j_name</span> <span class="o">=</span> <span class="n">j_status_content</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">j_status_h</span> <span class="o">!=</span> <span class="n">JOB_COMPLETED</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Your current job &quot;</span><span class="si">{</span><span class="n">j_name</span><span class="si">}</span><span class="s1">&quot; (ID: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s1">) status is: </span><span class="si">{</span><span class="n">j_status_h</span><span class="si">}</span><span class="s1">. The &#39;</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s1">&#39;selected wait-time of </span><span class="si">{</span><span class="n">wait_time</span><span class="si">}</span><span class="s1"> was exceeded. Please, &#39;</span> <span class="o">+</span>
                  <span class="s1">&#39;consider to set a longer wait-time.&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">To further check your job status you can either go to &#39;</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">j_url</span><span class="si">}</span><span class="s1"> or use the following command:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                  <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">cloudos job status </span><span class="se">\\\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                  <span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">--apikey $MY_API_KEY </span><span class="se">\\\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">--cloudos-url </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="si">}</span><span class="s1"> </span><span class="se">\\\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1">--job-id </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">j_name</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">job_id</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">j_status_h</span><span class="p">}</span></div>


<div class="viewcode-block" id="Cloudos.get_storage_contents">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.get_storage_contents">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_storage_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">cloud_name</span><span class="p">,</span> <span class="n">cloud_meta</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the contents of a storage container from the specified cloud service.</span>

<span class="sd">        This method fetches the contents of a specified path within a storage container</span>
<span class="sd">        on a cloud service (e.g., AWS S3 or Azure Blob). The request is authenticated</span>
<span class="sd">        using an API key and requires valid parameters such as the workspace ID and path.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            cloud_name (str): The name of the cloud service (e.g., &#39;aws&#39; or &#39;azure&#39;).</span>
<span class="sd">            container (str): The name of the storage container or bucket.</span>
<span class="sd">            path (str): The file path or directory within the storage container.</span>
<span class="sd">            workspace_id (str): The identifier of the workspace or team.</span>
<span class="sd">            verify (bool): Whether to verify SSL certificates for the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of contents retrieved from the specified cloud storage.</span>

<span class="sd">        Raises:</span>
<span class="sd">            BadRequestException: If the request to retrieve the contents fails with a</span>
<span class="sd">            status code indicating an error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
        <span class="p">}</span>
        <span class="n">cloud_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;aws&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="si">}</span><span class="s2">/api/v1/data-access/s3/bucket-contents&quot;</span><span class="p">,</span>
                <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;bucket&quot;</span><span class="p">:</span> <span class="n">container</span><span class="p">,</span>
                    <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
                    <span class="s2">&quot;teamId&quot;</span><span class="p">:</span> <span class="n">workspace_id</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;azure&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="si">}</span><span class="s2">/api/v1/data-access/azure/container-contents&quot;</span><span class="p">,</span>
                <span class="s2">&quot;container&quot;</span><span class="p">:</span> <span class="s2">&quot;containerName&quot;</span><span class="p">,</span>
                <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;containerName&quot;</span><span class="p">:</span> <span class="n">container</span><span class="p">,</span>
                    <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;storageAccountName&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;teamId&quot;</span><span class="p">:</span> <span class="n">workspace_id</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">cloud_name</span> <span class="o">==</span> <span class="s2">&quot;azure&quot;</span><span class="p">:</span>
            <span class="n">cloud_data</span><span class="p">[</span><span class="n">cloud_name</span><span class="p">][</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;storageAccountName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cloud_meta</span><span class="p">[</span><span class="s2">&quot;storage&quot;</span><span class="p">][</span><span class="s2">&quot;storageAccount&quot;</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">cloud_data</span><span class="p">[</span><span class="n">cloud_name</span><span class="p">][</span><span class="s2">&quot;params&quot;</span><span class="p">]</span>
        <span class="n">contents_req</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span><span class="n">cloud_data</span><span class="p">[</span><span class="n">cloud_name</span><span class="p">][</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">contents_req</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">contents_req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contents_req</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;contents&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="Cloudos.get_job_workdir">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.get_job_workdir">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_job_workdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">j_id</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the working directory for the specified job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cloudos_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span>
        <span class="n">apikey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="n">apikey</span>
        <span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cloudos_url</span><span class="si">}</span><span class="s2">/api/v1/jobs/</span><span class="si">{</span><span class="n">j_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotAuthorisedException</span>
        <span class="k">elif</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">403</span><span class="p">:</span>
            <span class="c1"># Handle 403 with more informative error message</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_job_access_denied</span><span class="p">(</span><span class="n">j_id</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">r_json</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">job_workspace</span> <span class="o">=</span> <span class="n">r_json</span><span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">job_workspace</span> <span class="o">!=</span> <span class="n">workspace_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Workspace provided or configured is different from workspace where the job was executed&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;resumeWorkDir&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r_json</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Message]: Working directories are not available. This may be because the analysis was run without resumable mode enabled, or because intermediate results have since been removed.&quot;</span><span class="p">)</span>
        <span class="c1"># Check if logs field exists, if not fall back to original folder-based approach</span>
        <span class="k">elif</span> <span class="s2">&quot;logs&quot;</span> <span class="ow">in</span> <span class="n">r_json</span><span class="p">:</span>
            <span class="c1"># Get workdir information from logs object using the same pattern as get_job_logs</span>
            <span class="n">logs_obj</span> <span class="o">=</span> <span class="n">r_json</span><span class="p">[</span><span class="s2">&quot;logs&quot;</span><span class="p">]</span>
            <span class="n">cloud_name</span><span class="p">,</span> <span class="n">cloud_meta</span><span class="p">,</span> <span class="n">cloud_storage</span> <span class="o">=</span> <span class="n">find_cloud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">logs_obj</span><span class="p">)</span>
            <span class="n">container_name</span> <span class="o">=</span> <span class="n">cloud_storage</span><span class="p">[</span><span class="s2">&quot;container&quot;</span><span class="p">]</span>
            <span class="n">prefix_name</span> <span class="o">=</span> <span class="n">cloud_storage</span><span class="p">[</span><span class="s2">&quot;prefix&quot;</span><span class="p">]</span>
            <span class="n">logs_bucket</span> <span class="o">=</span> <span class="n">logs_obj</span><span class="p">[</span><span class="n">container_name</span><span class="p">]</span>
            <span class="n">logs_path</span> <span class="o">=</span> <span class="n">logs_obj</span><span class="p">[</span><span class="n">prefix_name</span><span class="p">]</span>
            
            <span class="c1"># Construct workdir path by replacing &#39;/logs&#39; with &#39;/work&#39; in the logs path</span>
            <span class="n">workdir_path_suffix</span> <span class="o">=</span> <span class="n">logs_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/logs&#39;</span><span class="p">,</span> <span class="s1">&#39;/work&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">cloud_name</span> <span class="o">==</span> <span class="s2">&quot;aws&quot;</span><span class="p">:</span>
                <span class="n">workdir_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;s3://</span><span class="si">{</span><span class="n">logs_bucket</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">workdir_path_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">cloud_name</span> <span class="o">==</span> <span class="s2">&quot;azure&quot;</span><span class="p">:</span>
                <span class="n">storage_account_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">cloude_scheme</span> <span class="o">=</span> <span class="n">cloud_storage</span><span class="p">[</span><span class="s2">&quot;scheme&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">cloude_scheme</span> <span class="o">==</span> <span class="s1">&#39;az&#39;</span><span class="p">:</span>
                    <span class="n">storage_account_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;az://</span><span class="si">{</span><span class="n">cloud_meta</span><span class="p">[</span><span class="s1">&#39;storage&#39;</span><span class="p">][</span><span class="s1">&#39;storageAccount&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.blob.core.windows.net&quot;</span>
                <span class="n">workdir_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">storage_account_prefix</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">logs_bucket</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">workdir_path_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported cloud provider&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">workdir_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fallback to original folder-based approach for backward compatibility</span>
            <span class="n">workdir_id</span> <span class="o">=</span> <span class="n">r_json</span><span class="p">[</span><span class="s2">&quot;resumeWorkDir&quot;</span><span class="p">]</span>

            <span class="c1"># This will fail, as the API endpoint is not open. This works when adding</span>
            <span class="c1"># the authorisation bearer token manually to the headers</span>
            <span class="n">workdir_bucket_r</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cloudos_url</span><span class="si">}</span><span class="s2">/api/v1/folders&quot;</span><span class="p">,</span>
                                                    <span class="n">params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">workdir_id</span><span class="p">,</span> <span class="n">teamId</span><span class="o">=</span><span class="n">workspace_id</span><span class="p">),</span> 
                                                    <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">workdir_bucket_r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotAuthorisedException</span>
            <span class="k">elif</span> <span class="n">workdir_bucket_r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">workdir_bucket_r</span><span class="p">)</span>

            <span class="n">workdir_bucket_o</span> <span class="o">=</span> <span class="n">workdir_bucket_r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">workdir_bucket_o</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request returned more than one result for folder id </span><span class="si">{</span><span class="n">workdir_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">workdir_bucket_info</span> <span class="o">=</span> <span class="n">workdir_bucket_o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">workdir_bucket_info</span><span class="p">[</span><span class="s2">&quot;folderType&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;S3Folder&quot;</span><span class="p">:</span>
                <span class="n">cloud_name</span> <span class="o">=</span> <span class="s2">&quot;aws&quot;</span>
            <span class="k">elif</span> <span class="n">workdir_bucket_info</span><span class="p">[</span><span class="s2">&quot;folderType&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AzureBlobFolder&quot;</span><span class="p">:</span>
                <span class="n">cloud_name</span> <span class="o">=</span> <span class="s2">&quot;azure&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported cloud provider&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cloud_name</span> <span class="o">==</span> <span class="s2">&quot;aws&quot;</span><span class="p">:</span>
                <span class="n">bucket_name</span> <span class="o">=</span> <span class="n">workdir_bucket_info</span><span class="p">[</span><span class="s2">&quot;s3BucketName&quot;</span><span class="p">]</span>
                <span class="n">bucket_path</span> <span class="o">=</span> <span class="n">workdir_bucket_info</span><span class="p">[</span><span class="s2">&quot;s3Prefix&quot;</span><span class="p">]</span>
                <span class="n">workdir_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;s3://</span><span class="si">{</span><span class="n">bucket_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">bucket_path</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">cloud_name</span> <span class="o">==</span> <span class="s2">&quot;azure&quot;</span><span class="p">:</span>
                <span class="n">storage_account</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;az://</span><span class="si">{</span><span class="n">workspace_id</span><span class="si">}</span><span class="s2">.blob.core.windows.net&quot;</span>
                <span class="n">container_name</span> <span class="o">=</span> <span class="n">workdir_bucket_info</span><span class="p">[</span><span class="s2">&quot;blobContainerName&quot;</span><span class="p">]</span>
                <span class="n">blob_prefix</span> <span class="o">=</span> <span class="n">workdir_bucket_info</span><span class="p">[</span><span class="s2">&quot;blobPrefix&quot;</span><span class="p">]</span>
                <span class="n">workdir_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">storage_account</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">container_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">blob_prefix</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported cloud provider&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">workdir_path</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_job_access_denied</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle 403 errors with more informative messages by checking job ownership</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Try to get current user info</span>
            <span class="n">current_user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_info</span><span class="p">(</span><span class="n">verify</span><span class="p">)</span>
            <span class="n">current_user_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">current_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">current_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;surname&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">current_user_name</span><span class="p">:</span>
                <span class="n">current_user_name</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">current_user_name</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Try to get job info from job list to see the owner</span>
            <span class="n">jobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_list</span><span class="p">(</span><span class="n">workspace_id</span><span class="p">,</span> <span class="n">last_n_jobs</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
            <span class="n">job_owner_name</span> <span class="o">=</span> <span class="kc">None</span>
            
            <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_id&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">job_id</span><span class="p">:</span>
                    <span class="n">user_info</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="n">job_owner_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">user_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;surname&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">job_owner_name</span><span class="p">:</span>
                        <span class="n">job_owner_name</span> <span class="o">=</span> <span class="n">user_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
                    <span class="k">break</span>
            
            <span class="k">raise</span> <span class="n">JobAccessDeniedException</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">job_owner_name</span><span class="p">,</span> <span class="n">current_user_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">JobAccessDeniedException</span><span class="p">:</span>
            <span class="c1"># Re-raise the specific exception</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># If we can&#39;t get detailed info, fall back to generic message</span>
            <span class="k">raise</span> <span class="n">JobAccessDeniedException</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>

<div class="viewcode-block" id="Cloudos.get_job_logs">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.get_job_logs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_job_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">j_id</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the location of the logs for the specified job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cloudos_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span>
        <span class="n">apikey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="n">apikey</span>
        <span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cloudos_url</span><span class="si">}</span><span class="s2">/api/v1/jobs/</span><span class="si">{</span><span class="n">j_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotAuthorisedException</span>
        <span class="k">elif</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">r_json</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">logs_obj</span> <span class="o">=</span> <span class="n">r_json</span><span class="p">[</span><span class="s2">&quot;logs&quot;</span><span class="p">]</span>
        <span class="n">job_workspace</span> <span class="o">=</span> <span class="n">r_json</span><span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">job_workspace</span> <span class="o">!=</span> <span class="n">workspace_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Workspace provided or configured is different from workspace where the job was executed&quot;</span><span class="p">)</span>
        <span class="n">cloud_name</span><span class="p">,</span> <span class="n">cloud_meta</span><span class="p">,</span> <span class="n">cloud_storage</span> <span class="o">=</span> <span class="n">find_cloud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">logs_obj</span><span class="p">)</span>
        <span class="n">container_name</span> <span class="o">=</span> <span class="n">cloud_storage</span><span class="p">[</span><span class="s2">&quot;container&quot;</span><span class="p">]</span>
        <span class="n">prefix_name</span> <span class="o">=</span> <span class="n">cloud_storage</span><span class="p">[</span><span class="s2">&quot;prefix&quot;</span><span class="p">]</span>
        <span class="n">logs_bucket</span> <span class="o">=</span> <span class="n">logs_obj</span><span class="p">[</span><span class="n">container_name</span><span class="p">]</span>
        <span class="n">logs_path</span> <span class="o">=</span> <span class="n">logs_obj</span><span class="p">[</span><span class="n">prefix_name</span><span class="p">]</span>
        <span class="n">contents_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_contents</span><span class="p">(</span><span class="n">cloud_name</span><span class="p">,</span> <span class="n">cloud_meta</span><span class="p">,</span> <span class="n">logs_bucket</span><span class="p">,</span> <span class="n">logs_path</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="p">)</span>
        <span class="n">logs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cloude_scheme</span> <span class="o">=</span> <span class="n">cloud_storage</span><span class="p">[</span><span class="s2">&quot;scheme&quot;</span><span class="p">]</span>
        <span class="n">storage_account_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">cloude_scheme</span> <span class="o">==</span> <span class="s1">&#39;az&#39;</span><span class="p">:</span>
            <span class="n">storage_account_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">workspace_id</span><span class="si">}</span><span class="s1">.blob.core.windows.net/&#39;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">contents_obj</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;isDir&quot;</span><span class="p">]:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;stdout.txt&quot;</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;Nextflow standard output&quot;</span>
                <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;.nextflow.log&quot;</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;Nextflow log&quot;</span>
                <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;trace.txt&quot;</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;Trace file&quot;</span>
                <span class="n">logs</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cloude_scheme</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">storage_account_prefix</span><span class="si">}{</span><span class="n">logs_bucket</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">logs</span></div>


<div class="viewcode-block" id="Cloudos.get_job_results">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.get_job_results">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_job_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">j_id</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the location of the results for the specified job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cloudos_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span>
        <span class="n">apikey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="n">apikey</span>
        <span class="p">}</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">j_id</span><span class="p">,</span> <span class="n">verify</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="n">JOB_COMPLETED</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JoBNotCompletedException</span><span class="p">(</span><span class="n">j_id</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cloudos_url</span><span class="si">}</span><span class="s2">/api/v1/jobs/</span><span class="si">{</span><span class="n">j_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                               <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotAuthorisedException</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">req_obj</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">job_workspace</span> <span class="o">=</span> <span class="n">req_obj</span><span class="p">[</span><span class="s2">&quot;team&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">job_workspace</span> <span class="o">!=</span> <span class="n">workspace_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Workspace provided or configured is different from workspace where the job was executed&quot;</span><span class="p">)</span>
        <span class="n">cloud_name</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">cloud_storage</span> <span class="o">=</span> <span class="n">find_cloud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">req_obj</span><span class="p">[</span><span class="s2">&quot;logs&quot;</span><span class="p">])</span>
        <span class="c1"># cont_name</span>
        <span class="n">results_obj</span> <span class="o">=</span> <span class="n">req_obj</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span>
        <span class="n">results_container</span> <span class="o">=</span> <span class="n">results_obj</span><span class="p">[</span><span class="n">cloud_storage</span><span class="p">[</span><span class="s2">&quot;container&quot;</span><span class="p">]]</span>
        <span class="n">results_path</span> <span class="o">=</span> <span class="n">results_obj</span><span class="p">[</span><span class="n">cloud_storage</span><span class="p">[</span><span class="s2">&quot;prefix&quot;</span><span class="p">]]</span>
        <span class="n">scheme</span> <span class="o">=</span> <span class="n">cloud_storage</span><span class="p">[</span><span class="s2">&quot;scheme&quot;</span><span class="p">]</span>
        <span class="n">contents_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storage_contents</span><span class="p">(</span><span class="n">cloud_name</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">results_container</span><span class="p">,</span>
                                                 <span class="n">results_path</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="p">)</span>
        <span class="n">storage_account_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">scheme</span> <span class="o">==</span> <span class="s1">&#39;az&#39;</span><span class="p">:</span>
            <span class="n">storage_account_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">workspace_id</span><span class="si">}</span><span class="s1">.blob.core.windows.net/&#39;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">contents_obj</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;isDir&quot;</span><span class="p">]:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="n">results</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">storage_account_prefix</span><span class="si">}{</span><span class="n">results_container</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">results</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_create_cromwell_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates cromwell header.</span>

<span class="sd">        This methods is responsible for using personal API key instead of</span>
<span class="sd">        specific Cromwell API when the later is not provided.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        headers : dict</span>
<span class="sd">            The correct headers based on using cromwell specific token or</span>
<span class="sd">            personal API key.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cromwell_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
                <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cromwell_token</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">headers</span>

<div class="viewcode-block" id="Cloudos.resolve_user_id">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.resolve_user_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_user_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_owner</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resolve a username or display name to a user ID.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filter_owner : str</span>
<span class="sd">            The username or display name to search for.</span>
<span class="sd">        workspace_id : str</span>
<span class="sd">            The CloudOS workspace ID.</span>
<span class="sd">        verify : [bool|string]</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The user ID corresponding to the filter_owner.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the user cannot be found or if there&#39;s an error during the search.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">search_headers</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
                <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
            <span class="p">}</span>
            <span class="n">search_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="n">filter_owner</span><span class="p">,</span>
                <span class="s2">&quot;teamId&quot;</span><span class="p">:</span> <span class="n">workspace_id</span>
            <span class="p">}</span>
            <span class="c1"># Note: this endpoint may not be open in all CloudOS instances</span>
            <span class="n">user_search_r</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="si">}</span><span class="s2">/api/v1/users/search-assist&quot;</span><span class="p">,</span>
                                             <span class="n">params</span><span class="o">=</span><span class="n">search_params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">search_headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">user_search_r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error searching for user &#39;</span><span class="si">{</span><span class="n">filter_owner</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            
            <span class="n">user_search_content</span> <span class="o">=</span> <span class="n">user_search_r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">user_items</span> <span class="o">=</span> <span class="n">user_search_content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="n">user_items</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">user_match</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">user_items</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">filter_owner</span> <span class="ow">or</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">filter_owner</span><span class="p">:</span>
                        <span class="n">user_match</span> <span class="o">=</span> <span class="n">user</span>
                        <span class="k">break</span>
                
                <span class="k">if</span> <span class="n">user_match</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">user_match</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">filter_owner</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">filter_owner</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error resolving user &#39;</span><span class="si">{</span><span class="n">filter_owner</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Cloudos.get_cromwell_status">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.get_cromwell_status">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cromwell_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get Cromwell server status from CloudOS.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        workspace_id : string</span>
<span class="sd">            The CloudOS workspace id from to check the Cromwell status.</span>
<span class="sd">        verify: [bool|string]</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        r : requests.models.Response</span>
<span class="sd">            The server response</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cloudos_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_cromwell_header</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/api/v1/cromwell?teamId=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cloudos_url</span><span class="p">,</span>
                                                                     <span class="n">workspace_id</span><span class="p">),</span>
                               <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span></div>


<div class="viewcode-block" id="Cloudos.cromwell_switch">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.cromwell_switch">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cromwell_switch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Restart Cromwell server.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        workspace_id : string</span>
<span class="sd">            The CloudOS workspace id in which restart/stop Cromwell status.</span>
<span class="sd">        action : string [restart|stop]</span>
<span class="sd">            The action to perform.</span>
<span class="sd">        verify: [bool|string]</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        r : requests.models.Response</span>
<span class="sd">            The server response</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cloudos_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_cromwell_header</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/api/v1/cromwell/</span><span class="si">{}</span><span class="s2">?teamId=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cloudos_url</span><span class="p">,</span>
                                                                  <span class="n">action</span><span class="p">,</span>
                                                                  <span class="n">workspace_id</span><span class="p">),</span>
                         <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span></div>


<div class="viewcode-block" id="Cloudos.get_job_list">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.get_job_list">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_job_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">last_n_jobs</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">archived</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">filter_status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filter_job_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">filter_project</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filter_workflow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filter_job_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">filter_only_mine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filter_owner</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filter_queue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get jobs from a CloudOS workspace with optional filtering.</span>
<span class="sd">        </span>
<span class="sd">        Fetches jobs page by page, applies all filters after fetching.</span>
<span class="sd">        Stops when enough jobs are collected or no more jobs are available.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        workspace_id : string</span>
<span class="sd">            The CloudOS workspace id from to collect the jobs.</span>
<span class="sd">        last_n_jobs : [int | &#39;all&#39;]</span>
<span class="sd">            How many of the last jobs from the user to retrieve. You can specify a</span>
<span class="sd">            very large int or &#39;all&#39; to get all user&#39;s jobs.</span>
<span class="sd">        page : int</span>
<span class="sd">            Response page to get (ignored when using filters - starts from page 1).</span>
<span class="sd">        archived : bool</span>
<span class="sd">            When True, only the archived jobs are retrieved.</span>
<span class="sd">        verify: [bool|string]</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file.</span>
<span class="sd">        filter_status : string, optional</span>
<span class="sd">            Filter jobs by status (e.g., &#39;completed&#39;, &#39;running&#39;, &#39;failed&#39;).</span>
<span class="sd">        filter_job_name : string, optional</span>
<span class="sd">            Filter jobs by name.</span>
<span class="sd">        filter_project : string, optional</span>
<span class="sd">            Filter jobs by project name (will be resolved to project ID).</span>
<span class="sd">        filter_workflow : string, optional</span>
<span class="sd">            Filter jobs by workflow name (will be resolved to workflow ID).</span>
<span class="sd">        filter_job_id : string, optional</span>
<span class="sd">            Filter jobs by specific job ID.</span>
<span class="sd">        filter_only_mine : bool, optional</span>
<span class="sd">            Filter to show only jobs belonging to the current user.</span>
<span class="sd">        filter_owner : string, optional</span>
<span class="sd">            Filter jobs by owner username (will be resolved to user ID).</span>
<span class="sd">        filter_queue : string, optional</span>
<span class="sd">            Filter jobs by queue name (will be resolved to queue ID).</span>
<span class="sd">            Only applies to jobs running in batch environment.</span>
<span class="sd">            Non-batch jobs are preserved in results as they don&#39;t use queues.</span>
<span class="sd">        last : bool, optional</span>
<span class="sd">            When workflows are duplicated, use the latest imported workflow (by date).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        r : list</span>
<span class="sd">            A list of dicts, each corresponding to a jobs from the user and the workspace.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">workspace_id</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">workspace_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid workspace_id: must be a non-empty string&quot;</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="n">last_n_jobs</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">last_n_jobs</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">last_n_jobs</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;last_n_jobs must be a positive integer or &#39;all&#39;&quot;</span><span class="p">)</span>
        
        <span class="c1"># Validate filter_status values</span>
        <span class="k">if</span> <span class="n">filter_status</span><span class="p">:</span>
            <span class="n">valid_statuses</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="s1">&#39;running&#39;</span><span class="p">,</span> <span class="s1">&#39;failed&#39;</span><span class="p">,</span> <span class="s1">&#39;aborted&#39;</span><span class="p">,</span> <span class="s1">&#39;queued&#39;</span><span class="p">,</span> <span class="s1">&#39;pending&#39;</span><span class="p">,</span> <span class="s1">&#39;initializing&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">filter_status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_statuses</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid filter_status &#39;</span><span class="si">{</span><span class="n">filter_status</span><span class="si">}</span><span class="s2">&#39;. Valid values: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">valid_statuses</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
        <span class="p">}</span>
        
        <span class="c1"># Build query parameters for server-side filtering</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;teamId&quot;</span><span class="p">:</span> <span class="n">workspace_id</span><span class="p">,</span>
            <span class="s2">&quot;archived.status&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">archived</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>  <span class="c1"># Use a reasonable page size</span>
            <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="mi">1</span>     <span class="c1"># Always start from page 1</span>
        <span class="p">}</span>
        
        <span class="c1"># --- Resolve IDs once (before pagination loop) ---</span>
        
        <span class="c1"># Add simple server-side filters</span>
        <span class="k">if</span> <span class="n">filter_status</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">filter_job_name</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_job_name</span>
        <span class="k">if</span> <span class="n">filter_job_id</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_job_id</span>
            
        <span class="c1"># Resolve project name to ID</span>
        <span class="k">if</span> <span class="n">filter_project</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">project_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project_id_from_name</span><span class="p">(</span><span class="n">workspace_id</span><span class="p">,</span> <span class="n">filter_project</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">project_id</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;project.id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">project_id</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project &#39;</span><span class="si">{</span><span class="n">filter_project</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error resolving project &#39;</span><span class="si">{</span><span class="n">filter_project</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Resolve workflow name to ID</span>
        <span class="k">if</span> <span class="n">filter_workflow</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">workflow_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_workflow_content</span><span class="p">(</span><span class="n">workspace_id</span><span class="p">,</span> <span class="n">filter_workflow</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="n">last</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">workflow_content</span> <span class="ow">and</span> <span class="n">workflow_content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;workflows&quot;</span><span class="p">):</span>
                    <span class="c1"># Extract the first (and should be only) workflow from the list</span>
                    <span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow_content</span><span class="p">[</span><span class="s2">&quot;workflows&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">workflow_id</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_id&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">workflow_id</span><span class="p">:</span>
                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;workflow.id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">workflow_id</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Workflow &#39;</span><span class="si">{</span><span class="n">filter_workflow</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Workflow &#39;</span><span class="si">{</span><span class="n">filter_workflow</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error resolving workflow &#39;</span><span class="si">{</span><span class="n">filter_workflow</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Get current user ID for filter_only_mine</span>
        <span class="k">if</span> <span class="n">filter_only_mine</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">user_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_info</span><span class="p">(</span><span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
                <span class="n">user_id</span> <span class="o">=</span> <span class="n">user_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">user_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_id&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">user_id</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;user.id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_id</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not retrieve current user information.&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting current user info: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Resolve owner username to user ID</span>
        <span class="k">if</span> <span class="n">filter_owner</span><span class="p">:</span>
            <span class="n">user_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_user_id</span><span class="p">(</span><span class="n">filter_owner</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="p">)</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;user.id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_id</span>

        <span class="c1"># --- Fetch jobs page by page ---</span>
        <span class="n">all_jobs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_page</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_page</span>
            
            <span class="n">r</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="si">}</span><span class="s2">/api/v2/jobs&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            
            <span class="n">content</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">page_jobs</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jobs&#39;</span><span class="p">,</span> <span class="p">[])</span>
            
            <span class="c1"># No jobs returned, we&#39;ve reached the end</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">page_jobs</span><span class="p">:</span>
                <span class="k">break</span>
                
            <span class="n">all_jobs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">page_jobs</span><span class="p">)</span>
            
            <span class="c1"># Check if we have enough jobs or reached the last page</span>
            <span class="k">if</span> <span class="n">last_n_jobs</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_jobs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">last_n_jobs</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">page_jobs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]:</span>
                <span class="k">break</span>  <span class="c1"># Last page (fewer jobs than requested page size)</span>
                
            <span class="n">current_page</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># --- Local queue filtering (not supported by API) ---</span>
        <span class="k">if</span> <span class="n">filter_queue</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">batch_jobs</span><span class="o">=</span><span class="p">[</span><span class="n">job</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">all_jobs</span> <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;batch&quot;</span><span class="p">,</span> <span class="p">{})]</span>
                <span class="k">if</span> <span class="n">batch_jobs</span><span class="p">:</span>
                    <span class="kn">from</span><span class="w"> </span><span class="nn">cloudos_cli.queue.queue</span><span class="w"> </span><span class="kn">import</span> <span class="n">Queue</span>
                    <span class="n">queue_api</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cromwell_token</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="p">)</span>
                    <span class="n">queues</span> <span class="o">=</span> <span class="n">queue_api</span><span class="o">.</span><span class="n">get_job_queues</span><span class="p">()</span>
                    
                    <span class="n">queue_id</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">for</span> <span class="n">queue</span> <span class="ow">in</span> <span class="n">queues</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">filter_queue</span> <span class="ow">or</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">filter_queue</span><span class="p">:</span>
                            <span class="n">queue_id</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_id&quot;</span><span class="p">)</span>
                            <span class="k">break</span>
                    
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">queue_id</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Queue with name &#39;</span><span class="si">{</span><span class="n">filter_queue</span><span class="si">}</span><span class="s2">&#39; not found in workspace &#39;</span><span class="si">{</span><span class="n">workspace_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    
                    <span class="n">all_jobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">job</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">all_jobs</span> <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;batch&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;jobQueue&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">queue_id</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The environment is not a batch environment so queues do not exist. Please remove the --filter-queue option.&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error filtering by queue &#39;</span><span class="si">{</span><span class="n">filter_queue</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># --- Apply limit after all filtering ---</span>
        <span class="k">if</span> <span class="n">last_n_jobs</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">last_n_jobs</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">last_n_jobs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">all_jobs</span> <span class="o">=</span> <span class="n">all_jobs</span><span class="p">[:</span><span class="n">last_n_jobs</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">all_jobs</span></div>


<div class="viewcode-block" id="Cloudos.process_job_list">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.process_job_list">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">process_job_list</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">all_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a job list from a self.get_job_list call.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        r : list</span>
<span class="sd">            A list of dicts, each corresponding to a job from the user and the workspace.</span>
<span class="sd">        all_fields : bool. Default=False</span>
<span class="sd">            Whether to return a reduced version of the DataFrame containing</span>
<span class="sd">            only the selected columns or the full DataFrame.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df : pandas.DataFrame</span>
<span class="sd">            A DataFrame with the requested columns from the jobs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;project.name&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;user.name&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;user.surname&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;workflow.name&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;_id&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;startTime&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;endTime&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;createdAt&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;updatedAt&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;revision.commit&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;realInstancesExecutionCost&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;masterInstance.usedInstance.type&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;storageMode&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;workflow.repository.url&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;nextflowVersion&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;batch.enabled&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;storageSizeInGb&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;batch.jobQueue.id&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;usesFusionFileSystem&#39;</span>
                   <span class="p">]</span>
        <span class="n">df_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df_full</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df_full</span>
        <span class="k">if</span> <span class="n">all_fields</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df_full</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Only select columns that actually exist in the DataFrame</span>
            <span class="n">existing_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">COLUMNS</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_full</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">existing_columns</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df_full</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">existing_columns</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If none of the predefined columns exist, raise missing error</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;None of the predefined columns </span><span class="si">{</span><span class="n">COLUMNS</span><span class="si">}</span><span class="s2"> exist in retrieved columns:</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">df_full</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="Cloudos.reorder_job_list">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.reorder_job_list">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reorder_job_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">my_jobs_df</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;my_jobs.csv&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save a job list DataFrame to a CSV file with renamed and ordered columns.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        my_jobs_df : pandas.DataFrame</span>
<span class="sd">            A DataFrame containing job information from process_job_list.</span>
<span class="sd">        filename : str</span>
<span class="sd">            The name of the file to save the DataFrame to. Default is &#39;my_jobs.csv&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Saves the DataFrame to a CSV file with renamed and ordered columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Handle empty DataFrame</span>
        <span class="k">if</span> <span class="n">my_jobs_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: DataFrame is empty. Creating empty CSV file.&quot;</span><span class="p">)</span>
            <span class="n">empty_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="n">empty_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Create a copy to avoid modifying the original DataFrame</span>
        <span class="n">jobs_df</span> <span class="o">=</span> <span class="n">my_jobs_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># 1. Fusion user.name and user.surname into user</span>
        <span class="k">if</span> <span class="s1">&#39;user.name&#39;</span> <span class="ow">in</span> <span class="n">jobs_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;user.surname&#39;</span> <span class="ow">in</span> <span class="n">jobs_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">jobs_df</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jobs_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user.name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user.surname&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user.name&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user.surname&#39;</span><span class="p">))</span>
                <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
            <span class="c1"># Remove original columns</span>
            <span class="n">jobs_df</span> <span class="o">=</span> <span class="n">jobs_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;user.name&#39;</span><span class="p">,</span> <span class="s1">&#39;user.surname&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

        <span class="c1"># 2. Convert time fields to human-readable format</span>
        <span class="n">time_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;startTime&#39;</span><span class="p">,</span> <span class="s1">&#39;endTime&#39;</span><span class="p">,</span> <span class="s1">&#39;createdAt&#39;</span><span class="p">,</span> <span class="s1">&#39;updatedAt&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">time_columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">jobs_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">format_time</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S UTC&#39;</span><span class="p">)</span>
                        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                            <span class="k">return</span> <span class="n">x</span>  <span class="c1"># Return original value if parsing fails</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="n">jobs_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">jobs_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">format_time</span><span class="p">)</span>

        <span class="c1"># 3. Format realInstancesExecutionCost (divide by 100, show 4 decimals)</span>
        <span class="k">if</span> <span class="s1">&#39;realInstancesExecutionCost&#39;</span> <span class="ow">in</span> <span class="n">jobs_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">format_cost</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">x</span>  <span class="c1"># Return original value if conversion fails</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">jobs_df</span><span class="p">[</span><span class="s1">&#39;realInstancesExecutionCost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jobs_df</span><span class="p">[</span><span class="s1">&#39;realInstancesExecutionCost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">format_cost</span><span class="p">)</span>

        <span class="c1"># 4. Calculate Run time (endTime - startTime)</span>
        <span class="k">if</span> <span class="s1">&#39;startTime&#39;</span> <span class="ow">in</span> <span class="n">jobs_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;endTime&#39;</span> <span class="ow">in</span> <span class="n">jobs_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">calculate_runtime</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;startTime&#39;</span><span class="p">)</span>
                <span class="n">end_time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;endTime&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">end_time</span><span class="p">)</span> <span class="ow">and</span> <span class="n">start_time</span> <span class="ow">and</span> <span class="n">end_time</span><span class="p">:</span>
                    <span class="c1"># Use original times from the original DataFrame for calculation</span>
                    <span class="n">original_start</span> <span class="o">=</span> <span class="n">my_jobs_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;startTime&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">name</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">my_jobs_df</span><span class="p">)</span> <span class="k">else</span> <span class="n">start_time</span>
                    <span class="n">original_end</span> <span class="o">=</span> <span class="n">my_jobs_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;endTime&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">name</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">my_jobs_df</span><span class="p">)</span> <span class="k">else</span> <span class="n">end_time</span>
                    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">original_start</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">original_end</span><span class="p">)</span> <span class="ow">and</span> <span class="n">original_start</span> <span class="ow">and</span> <span class="n">original_end</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">start_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">original_start</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span>
                            <span class="n">end_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">original_end</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span>
                            <span class="n">duration</span> <span class="o">=</span> <span class="n">end_dt</span> <span class="o">-</span> <span class="n">start_dt</span>
                            <span class="c1"># Format duration as hours:minutes:seconds</span>
                            <span class="n">total_seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
                            <span class="n">hours</span> <span class="o">=</span> <span class="n">total_seconds</span> <span class="o">//</span> <span class="mi">3600</span>
                            <span class="n">minutes</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_seconds</span> <span class="o">%</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">//</span> <span class="mi">60</span>
                            <span class="n">seconds</span> <span class="o">=</span> <span class="n">total_seconds</span> <span class="o">%</span> <span class="mi">60</span>
                            <span class="k">if</span> <span class="n">hours</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s2">h </span><span class="si">{</span><span class="n">minutes</span><span class="si">}</span><span class="s2">m </span><span class="si">{</span><span class="n">seconds</span><span class="si">}</span><span class="s2">s&quot;</span>
                            <span class="k">elif</span> <span class="n">minutes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">minutes</span><span class="si">}</span><span class="s2">m </span><span class="si">{</span><span class="n">seconds</span><span class="si">}</span><span class="s2">s&quot;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">seconds</span><span class="si">}</span><span class="s2">s&quot;</span>
                        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                            <span class="k">return</span> <span class="kc">None</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">jobs_df</span><span class="p">[</span><span class="s1">&#39;Run time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jobs_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">calculate_runtime</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># 5. Format batch.enabled (True -&gt; &quot;Batch&quot;, else &quot;N/A&quot;)</span>
        <span class="k">if</span> <span class="s1">&#39;batch.enabled&#39;</span> <span class="ow">in</span> <span class="n">jobs_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">jobs_df</span><span class="p">[</span><span class="s1">&#39;batch.enabled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jobs_df</span><span class="p">[</span><span class="s1">&#39;batch.enabled&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;Batch&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="s2">&quot;N/A&quot;</span>
            <span class="p">)</span>

        <span class="c1"># 6. Rename columns using the provided dictionary</span>
        <span class="n">column_name_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Status&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;project.name&quot;</span><span class="p">:</span> <span class="s2">&quot;Project&quot;</span><span class="p">,</span>
            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;Owner&quot;</span><span class="p">,</span>
            <span class="s2">&quot;workflow.name&quot;</span><span class="p">:</span> <span class="s2">&quot;Pipeline&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;ID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;Submit time&quot;</span><span class="p">,</span>
            <span class="s2">&quot;updatedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;End time&quot;</span><span class="p">,</span>
            <span class="s2">&quot;revision.commit&quot;</span><span class="p">:</span> <span class="s2">&quot;Commit&quot;</span><span class="p">,</span>
            <span class="s2">&quot;realInstancesExecutionCost&quot;</span><span class="p">:</span> <span class="s2">&quot;Cost&quot;</span><span class="p">,</span>
            <span class="s2">&quot;masterInstance.usedInstance.type&quot;</span><span class="p">:</span> <span class="s2">&quot;Resources&quot;</span><span class="p">,</span>
            <span class="s2">&quot;storageMode&quot;</span><span class="p">:</span> <span class="s2">&quot;Storage type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;workflow.repository.url&quot;</span><span class="p">:</span> <span class="s2">&quot;Pipeline url&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nextflowVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;Nextflow version&quot;</span><span class="p">,</span>
            <span class="s2">&quot;batch.enabled&quot;</span><span class="p">:</span> <span class="s2">&quot;Executor&quot;</span><span class="p">,</span>
            <span class="s2">&quot;storageSizeInGb&quot;</span><span class="p">:</span> <span class="s2">&quot;Storage size&quot;</span><span class="p">,</span>
            <span class="s2">&quot;batch.jobQueue.id&quot;</span><span class="p">:</span> <span class="s2">&quot;Job queue ID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;usesFusionFileSystem&quot;</span><span class="p">:</span> <span class="s2">&quot;Accelerated file staging&quot;</span>
        <span class="p">}</span>

        <span class="c1"># Rename columns that exist in the DataFrame</span>
        <span class="n">jobs_df</span> <span class="o">=</span> <span class="n">jobs_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">column_name_mapping</span><span class="p">)</span>

        <span class="c1"># Remove the original startTime and endTime columns since we now have Submit time, End time, and Run time</span>
        <span class="n">jobs_df</span> <span class="o">=</span> <span class="n">jobs_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;startTime&#39;</span><span class="p">,</span> <span class="s1">&#39;endTime&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

        <span class="c1"># 7. Define the desired order of columns</span>
        <span class="n">desired_order</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Project&quot;</span><span class="p">,</span> <span class="s2">&quot;Owner&quot;</span><span class="p">,</span> <span class="s2">&quot;Pipeline&quot;</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Submit time&quot;</span><span class="p">,</span> <span class="s2">&quot;End time&quot;</span><span class="p">,</span> <span class="s2">&quot;Run time&quot;</span><span class="p">,</span> <span class="s2">&quot;Commit&quot;</span><span class="p">,</span> <span class="s2">&quot;Cost&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Resources&quot;</span><span class="p">,</span> <span class="s2">&quot;Storage type&quot;</span><span class="p">,</span> <span class="s2">&quot;Pipeline url&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Nextflow version&quot;</span><span class="p">,</span> <span class="s2">&quot;Executor&quot;</span><span class="p">,</span> <span class="s2">&quot;Storage size&quot;</span><span class="p">,</span> <span class="s2">&quot;Job queue ID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Accelerated file staging&quot;</span>
        <span class="p">]</span>

        <span class="c1"># Reorder columns - only include columns that exist in the DataFrame</span>
        <span class="n">available_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">desired_order</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">jobs_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="c1"># Add any remaining columns that aren&#39;t in the desired order</span>
        <span class="n">remaining_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">jobs_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">desired_order</span><span class="p">]</span>
        <span class="n">final_column_order</span> <span class="o">=</span> <span class="n">available_columns</span> <span class="o">+</span> <span class="n">remaining_columns</span>

        <span class="c1"># Reorder the DataFrame</span>
        <span class="n">jobs_df</span> <span class="o">=</span> <span class="n">jobs_df</span><span class="p">[</span><span class="n">final_column_order</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">jobs_df</span></div>


<div class="viewcode-block" id="Cloudos.save_job_list_to_csv">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.save_job_list_to_csv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_job_list_to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">my_jobs_df</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;my_jobs.csv&#39;</span><span class="p">):</span>
        <span class="c1"># Save to CSV</span>
        <span class="n">jobs_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reorder_job_list</span><span class="p">(</span><span class="n">my_jobs_df</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">jobs_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Job list collected with a total of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">jobs_df</span><span class="p">)</span><span class="si">}</span><span class="s1"> jobs.&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Job list saved to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Cloudos.get_workflow_list">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.get_workflow_list">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_workflow_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">get_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_page_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                          <span class="n">archived_status</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all the workflows from a CloudOS workspace.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        workspace_id : string</span>
<span class="sd">            The CloudOS workspace id from to collect the workflows.</span>
<span class="sd">        verify : [bool|string]</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file.</span>
<span class="sd">        get_all : bool</span>
<span class="sd">            Whether to get all available curated workflows or just the</span>
<span class="sd">            indicated page.</span>
<span class="sd">        page : int</span>
<span class="sd">            The page number to retrieve, from the paginated response.</span>
<span class="sd">        page_size : int</span>
<span class="sd">            The number of workflows by page. From 1 to 1000.</span>
<span class="sd">        max_page_size : int</span>
<span class="sd">            Max page size defined by the API server. It is currently 1000.</span>
<span class="sd">        archived_status : bool</span>
<span class="sd">            Whether to retrieve archived workflows or not.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        r : list</span>
<span class="sd">            A list of dicts, each corresponding to a workflow.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
        <span class="p">}</span>
        <span class="n">archived_status</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">archived_status</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/api/v3/workflows?teamId=</span><span class="si">{}</span><span class="s2">&amp;pageSize=</span><span class="si">{}</span><span class="s2">&amp;page=</span><span class="si">{}</span><span class="s2">&amp;archived.status=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">page_size</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">archived_status</span><span class="p">),</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">get_all</span><span class="p">:</span>
            <span class="n">total_workflows</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="s1">&#39;paginationMetadata&#39;</span><span class="p">][</span><span class="s1">&#39;Pagination-Count&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">total_workflows</span> <span class="o">&lt;=</span> <span class="n">max_page_size</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/api/v3/workflows?teamId=</span><span class="si">{}</span><span class="s2">&amp;pageSize=</span><span class="si">{}</span><span class="s2">&amp;page=</span><span class="si">{}</span><span class="s2">&amp;archived.status=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">total_workflows</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">archived_status</span><span class="p">),</span>
                    <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)[</span><span class="s1">&#39;workflows&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n_pages</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_workflows</span> <span class="o">//</span> <span class="n">max_page_size</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">((</span><span class="n">total_workflows</span> <span class="o">%</span> <span class="n">max_page_size</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pages</span><span class="p">):</span>
                    <span class="n">p</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/api/v3/workflows?teamId=</span><span class="si">{}</span><span class="s2">&amp;pageSize=</span><span class="si">{}</span><span class="s2">&amp;page=</span><span class="si">{}</span><span class="s2">&amp;archived.status=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">max_page_size</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">archived_status</span><span class="p">),</span>
                        <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">all_content</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)[</span><span class="s1">&#39;workflows&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">all_content</span> <span class="o">+=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)[</span><span class="s1">&#39;workflows&#39;</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">all_content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">content</span><span class="p">[</span><span class="s1">&#39;workflows&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="Cloudos.process_workflow_list">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.process_workflow_list">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">process_workflow_list</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">all_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a server response from a self.get_workflow_list call.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        r : list</span>
<span class="sd">            A list of dicts, each corresponding to a workflow.</span>
<span class="sd">        all_fields : bool. Default=False</span>
<span class="sd">            Whether to return a reduced version of the DataFrame containing</span>
<span class="sd">            only the selected columns or the full DataFrame.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df : pandas.DataFrame</span>
<span class="sd">            A DataFrame with the requested columns from the workflows.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_id&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;archived.status&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;mainFile&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;workflowType&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;group&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;repository.name&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;repository.platform&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;repository.url&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;repository.isPrivate&#39;</span>
                   <span class="p">]</span>
        <span class="n">df_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">all_fields</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df_full</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">present_columns</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">COLUMNS</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df_full</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">present_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df_full</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">present_columns</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="Cloudos.detect_workflow">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.detect_workflow">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">detect_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detects workflow type: nextflow or wdl.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        workflow_name : string</span>
<span class="sd">            Name of the workflow.</span>
<span class="sd">        workspace_id : string</span>
<span class="sd">            The CloudOS workspace id from to collect the workflows.</span>
<span class="sd">        verify: [bool|string]</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        wt : string [&#39;nextflow&#39;|&#39;wdl&#39;]</span>
<span class="sd">            The workflow type detected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get list with workflow types</span>
        <span class="n">wt_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow_content_query</span><span class="p">(</span><span class="n">workspace_id</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s2">&quot;workflowType&quot;</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="n">last</span><span class="p">)</span>
        <span class="c1"># make unique</span>
        <span class="n">wt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">wt_all</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wt</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;More than one workflow type detected for </span><span class="si">{</span><span class="n">workflow_name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">wt</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">wt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="Cloudos.is_module">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.is_module">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detects whether the workflow is a system module or not.</span>

<span class="sd">        System modules use fixed queues, so this check is important to</span>
<span class="sd">        properly manage queue selection.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        workflow_name : string</span>
<span class="sd">            Name of the workflow.</span>
<span class="sd">        workspace_id : string</span>
<span class="sd">            The CloudOS workspace id from to collect the workflows.</span>
<span class="sd">        verify: [bool|string]</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True, if the workflow is a system module, false otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get a list of all groups</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow_content_query</span><span class="p">(</span><span class="n">workspace_id</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="n">last</span><span class="p">)</span>

        <span class="n">module_groups</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;system-tools&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;data-factory-data-connection-etl&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;data-factory&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;data-factory-omics-etl&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;drug-discovery&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;data-factory-omics-insights&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;intermediate&#39;</span>
                         <span class="p">]</span>
        <span class="k">if</span> <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">module_groups</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Cloudos.get_project_list">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.get_project_list">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_project_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">get_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_page_size</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all the project from a CloudOS workspace.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        workspace_id : string</span>
<span class="sd">            The CloudOS workspace id from to collect the projects.</span>
<span class="sd">        verify: [bool|string]</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file.</span>
<span class="sd">        get_all : bool</span>
<span class="sd">            Whether to get all available curated workflows or just the</span>
<span class="sd">            indicated page.</span>
<span class="sd">        page : int</span>
<span class="sd">            The page number to retrieve, from the paginated response.</span>
<span class="sd">        page_size : int</span>
<span class="sd">            The number of workflows by page. From 1 to 1000.</span>
<span class="sd">        max_page_size : int</span>
<span class="sd">            Max page size defined by the API server. It is currently 1000.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        r : requests.models.Response</span>
<span class="sd">            The server response</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
        <span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/api/v2/projects?teamId=</span><span class="si">{}</span><span class="s2">&amp;pageSize=</span><span class="si">{}</span><span class="s2">&amp;page=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">page_size</span><span class="p">,</span> <span class="n">page</span><span class="p">),</span>
                               <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">get_all</span><span class="p">:</span>
            <span class="n">total_projects</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">total_projects</span> <span class="o">&lt;=</span> <span class="n">max_page_size</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/api/v2/projects?teamId=</span><span class="si">{}</span><span class="s2">&amp;pageSize=</span><span class="si">{}</span><span class="s2">&amp;page=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">total_projects</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                       <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)[</span><span class="s1">&#39;projects&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n_pages</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_projects</span> <span class="o">//</span> <span class="n">max_page_size</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">((</span><span class="n">total_projects</span> <span class="o">%</span> <span class="n">max_page_size</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pages</span><span class="p">):</span>
                    <span class="n">p</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/api/v2/projects?teamId=</span><span class="si">{}</span><span class="s2">&amp;pageSize=</span><span class="si">{}</span><span class="s2">&amp;page=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">max_page_size</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span>
                        <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">all_content_p</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)[</span><span class="s1">&#39;projects&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">all_content_p</span> <span class="o">+=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)[</span><span class="s1">&#39;projects&#39;</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">all_content_p</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">content</span><span class="p">[</span><span class="s1">&#39;projects&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="Cloudos.process_project_list">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.process_project_list">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">process_project_list</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">all_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a server response from a self.get_project_list call.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        r : requests.models.Response</span>
<span class="sd">            A list of dicts, each corresponding to a project.</span>
<span class="sd">        all_fields : bool. Default=False</span>
<span class="sd">            Whether to return a reduced version of the DataFrame containing</span>
<span class="sd">            only the selected columns or the full DataFrame.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df : pandas.DataFrame</span>
<span class="sd">            A DataFrame with the requested columns from the projects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_id&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;name&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;user.id&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;user.name&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;user.surname&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;user.email&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;createdAt&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;updatedAt&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;workflowCount&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;jobCount&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;notebookSessionCount&#39;</span>
                   <span class="p">]</span>
        <span class="n">df_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df_full</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df_full</span>
        <span class="k">if</span> <span class="n">all_fields</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df_full</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df_full</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">COLUMNS</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="Cloudos.workflow_import">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.workflow_import">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">workflow_import</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">workflow_url</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">,</span>
                        <span class="n">repository_project_id</span><span class="p">,</span> <span class="n">workflow_docs_link</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="n">repository_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Imports workflows to CloudOS.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        workspace_id : string</span>
<span class="sd">            The CloudOS workspace id from to collect the projects.</span>
<span class="sd">        workflow_url : string</span>
<span class="sd">            The URL of the workflow. Only Github or Bitbucket are allowed.</span>
<span class="sd">        workflow_name : string</span>
<span class="sd">            A name for the imported pipeline in CloudOS.</span>
<span class="sd">        repository_project_id : int</span>
<span class="sd">            The repository project ID.</span>
<span class="sd">        workflow_docs_link : string</span>
<span class="sd">            Link to the documentation URL.</span>
<span class="sd">        repository_id : int</span>
<span class="sd">            The repository ID. Only required for GitHub repositories.</span>
<span class="sd">        verify: [bool|string]</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file.</span>

<span class="sd">        returns</span>
<span class="sd">        -------</span>
<span class="sd">        workflow_id : string</span>
<span class="sd">            The newly imported worflow ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">platform_url</span> <span class="o">=</span> <span class="n">workflow_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">repository_name</span> <span class="o">=</span> <span class="n">workflow_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">platform_url</span> <span class="o">==</span> <span class="s1">&#39;github&#39;</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="s1">&#39;github&#39;</span>
            <span class="n">repository_project</span> <span class="o">=</span> <span class="n">workflow_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">repository_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Please, specify --repository-id when importing a GitHub repository&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">platform_url</span> <span class="o">==</span> <span class="s1">&#39;bitbucket&#39;</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="s1">&#39;bitbucketServer&#39;</span>
            <span class="n">repository_project</span> <span class="o">=</span> <span class="n">workflow_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">repository_id</span> <span class="o">=</span> <span class="n">repository_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Your repository platform is not supported: </span><span class="si">{</span><span class="n">platform_url</span><span class="si">}</span><span class="s1">. &#39;</span> <span class="o">+</span>
                             <span class="s1">&#39;Please use either GitHub or BitbucketServer.&#39;</span><span class="p">)</span>
        <span class="n">repository_name</span> <span class="o">=</span> <span class="n">workflow_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;workflowType&quot;</span><span class="p">:</span> <span class="s2">&quot;nextflow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;repository&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;platform&quot;</span><span class="p">:</span> <span class="n">platform</span><span class="p">,</span>
                <span class="s2">&quot;repositoryId&quot;</span><span class="p">:</span> <span class="n">repository_id</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">repository_name</span><span class="p">,</span>
                <span class="s2">&quot;owner&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;login&quot;</span><span class="p">:</span> <span class="n">repository_project</span><span class="p">,</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">repository_project_id</span><span class="p">},</span>
                <span class="s2">&quot;isPrivate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">workflow_url</span><span class="p">,</span>
                <span class="s2">&quot;commit&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;branch&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">workflow_name</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;isPublic&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;mainFile&quot;</span><span class="p">:</span> <span class="s2">&quot;main.nf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;defaultContainer&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;processes&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;docsLink&quot;</span><span class="p">:</span> <span class="n">workflow_docs_link</span><span class="p">,</span>
            <span class="s2">&quot;team&quot;</span><span class="p">:</span> <span class="n">workspace_id</span>
        <span class="p">}</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
        <span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">retry_requests_post</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/api/v1/workflows?teamId=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="p">,</span>
                                                                       <span class="n">workspace_id</span><span class="p">),</span>
                                <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;It seems your API key is not authorised. Please check if &#39;</span> <span class="o">+</span>
                             <span class="s1">&#39;your workspace has support for importing workflows using cloudos-cli&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">content</span><span class="p">[</span><span class="s1">&#39;_id&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="Cloudos.get_user_info">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.get_user_info">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_user_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets user information from users/me endpoint</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        verify: [bool|string]</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        r : requests.models.Response.content</span>
<span class="sd">            The server response content</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
        <span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/api/v1/users/me&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="p">),</span>
                               <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></div>


<div class="viewcode-block" id="Cloudos.abort_job">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.abort_job">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">abort_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Abort a job.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        job : string</span>
<span class="sd">            The CloudOS job id of the job to abort.</span>
<span class="sd">        verify: [bool|string]</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        r : requests.models.Response</span>
<span class="sd">            The server response</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cloudos_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span>
        <span class="n">apikey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="n">apikey</span>
        <span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">retry_requests_put</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/api/v1/jobs/</span><span class="si">{}</span><span class="s2">/abort?teamId=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cloudos_url</span><span class="p">,</span> <span class="n">job</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">),</span>
                               <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span></div>


<div class="viewcode-block" id="Cloudos.get_project_id_from_name">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.get_project_id_from_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_project_id_from_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the project ID from its name.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        workspace_id : str</span>
<span class="sd">            The CloudOS workspace ID to search for the project.</span>
<span class="sd">        project_name : str</span>
<span class="sd">            The name of the project to search for.</span>
<span class="sd">        verify : [bool | str], optional</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file. Default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            The server response containing project details.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        BadRequestException</span>
<span class="sd">            If the request to retrieve the project fails with a status code</span>
<span class="sd">            indicating an error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
        <span class="p">}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="si">}</span><span class="s2">/api/v2/projects?teamId=</span><span class="si">{</span><span class="n">workspace_id</span><span class="si">}</span><span class="s2">&amp;search=</span><span class="si">{</span><span class="n">project_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="n">project_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_id&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projects&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">project_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">project_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Error] Project &#39;</span><span class="si">{</span><span class="n">project_name</span><span class="si">}</span><span class="s2">&#39; was not found in workspace &#39;</span><span class="si">{</span><span class="n">workspace_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">project_id</span></div>


<div class="viewcode-block" id="Cloudos.create_project">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.create_project">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new project in CloudOS.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        workspace_id : str</span>
<span class="sd">            The CloudOS workspace ID where the project will be created.</span>
<span class="sd">        project_name : str</span>
<span class="sd">            The name for the new project.</span>
<span class="sd">        verify : [bool | str], optional</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file. Default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The ID of the newly created project.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        BadRequestException</span>
<span class="sd">            If the request to create the project fails with a status code</span>
<span class="sd">            indicating an error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">project_name</span>
        <span class="p">}</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
        <span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">retry_requests_post</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/api/v1/projects?teamId=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="p">,</span>
                                                                      <span class="n">workspace_id</span><span class="p">),</span>
                                <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;It seems your API key is not authorised. Please check if &#39;</span> <span class="o">+</span>
                             <span class="s1">&#39;you have used the correct API key for the selected workspace&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">409</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;It seems that there is another project named &quot;</span><span class="si">{</span><span class="n">project_name</span><span class="si">}</span><span class="s1">&quot; &#39;</span> <span class="o">+</span>
                             <span class="s1">&#39;in your workspace, please use another name for the new project&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">content</span><span class="p">[</span><span class="s1">&#39;_id&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="Cloudos.get_workflow_max_pagination">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.get_workflow_max_pagination">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_workflow_max_pagination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the workflows max pages from API.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        workspace_id : str</span>
<span class="sd">            The CloudOS workspace ID to search for the workflow.</span>
<span class="sd">        workflow_name : str</span>
<span class="sd">            The name of the workflow to search for.</span>
<span class="sd">        verify : [bool | str], optional</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file. Default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The server response with max pagination for workflows.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        BadRequestException</span>
<span class="sd">            If the request to retrieve the project fails with a status code</span>
<span class="sd">            indicating an error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
        <span class="p">}</span>
        <span class="c1"># determine pagination, there might be a lot with the same name</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="si">}</span><span class="s2">/api/v3/workflows?teamId=</span><span class="si">{</span><span class="n">workspace_id</span><span class="si">}</span><span class="s2">&amp;search=</span><span class="si">{</span><span class="n">workflow_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">pag_content</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">max_pagination</span> <span class="o">=</span> <span class="n">pag_content</span><span class="p">[</span><span class="s2">&quot;paginationMetadata&quot;</span><span class="p">][</span><span class="s2">&quot;Pagination-Count&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">max_pagination</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No workflow found with name: </span><span class="si">{</span><span class="n">workflow_name</span><span class="si">}</span><span class="s1"> in workspace: </span><span class="si">{</span><span class="n">workspace_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">max_pagination</span></div>


<div class="viewcode-block" id="Cloudos.get_workflow_content">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.get_workflow_content">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_workflow_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_page_size</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the workflow content from API.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        workspace_id : str</span>
<span class="sd">            The CloudOS workspace ID to search for the workflow.</span>
<span class="sd">        workflow_name : str</span>
<span class="sd">            The name of the workflow to search for.</span>
<span class="sd">        verify : [bool | str], optional</span>
<span class="sd">            Whether to use SSL verification or not. Alternatively, if</span>
<span class="sd">            a string is passed, it will be interpreted as the path to</span>
<span class="sd">            the SSL certificate file. Default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            The server response containing workflow details.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        BadRequestException</span>
<span class="sd">            If the request to retrieve the project fails with a status code</span>
<span class="sd">            indicating an error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;apikey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">apikey</span>
        <span class="p">}</span>
        <span class="n">max_pagination</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_workflow_max_pagination</span><span class="p">(</span><span class="n">workspace_id</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>

        <span class="c1"># get all the matching content</span>
        <span class="k">if</span> <span class="n">max_pagination</span> <span class="o">&gt;</span> <span class="n">max_page_size</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;workflows&quot;</span><span class="p">:</span> <span class="p">[]}</span>
            <span class="k">for</span> <span class="n">page_start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_pagination</span><span class="p">,</span> <span class="n">max_page_size</span><span class="p">):</span>
                <span class="n">page_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_page_size</span><span class="p">,</span> <span class="n">max_pagination</span> <span class="o">-</span> <span class="n">page_start</span><span class="p">)</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="si">}</span><span class="s2">/api/v3/workflows?teamId=</span><span class="si">{</span><span class="n">workspace_id</span><span class="si">}</span><span class="s2">&amp;search=</span><span class="si">{</span><span class="n">workflow_name</span><span class="si">}</span><span class="s2">&amp;pageSize=</span><span class="si">{</span><span class="n">page_size</span><span class="si">}</span><span class="s2">&amp;page=</span><span class="si">{</span><span class="n">page_start</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">max_page_size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
                <span class="c1"># keep structure as a dict</span>
                <span class="n">content</span><span class="p">[</span><span class="s2">&quot;workflows&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;workflows&quot;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudos_url</span><span class="si">}</span><span class="s2">/api/v3/workflows?teamId=</span><span class="si">{</span><span class="n">workspace_id</span><span class="si">}</span><span class="s2">&amp;search=</span><span class="si">{</span><span class="n">workflow_name</span><span class="si">}</span><span class="s2">&amp;pageSize=</span><span class="si">{</span><span class="n">max_pagination</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">retry_requests_get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">)</span>
            <span class="c1"># return all content</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadRequestException</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="c1"># check for duplicates</span>
        <span class="n">wf</span> <span class="o">=</span> <span class="p">[</span><span class="n">wf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">wf</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;workflows&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">wf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">workflow_name</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wf</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="s2">&quot;workflows&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No workflow found with name: </span><span class="si">{</span><span class="n">workflow_name</span><span class="si">}</span><span class="s1"> in workspace: </span><span class="si">{</span><span class="n">workspace_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">last</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;More than one workflow found with name: </span><span class="si">{</span><span class="n">workflow_name</span><span class="si">}</span><span class="s1">. &#39;</span> <span class="o">+</span> \
                             <span class="s2">&quot;To run the last imported workflow use &#39;--last&#39; flag.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">youngest_workflow_id_by_name</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">content</span></div>


<div class="viewcode-block" id="Cloudos.workflow_content_query">
<a class="viewcode-back" href="../../_autosummary/cloudos_cli.clos.html#cloudos_cli.clos.Cloudos.workflow_content_query">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">workflow_content_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s2">&quot;workflowType&quot;</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_workflow_content</span><span class="p">(</span><span class="n">workspace_id</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="n">verify</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="n">last</span><span class="p">)</span>

        <span class="c1"># use &#39;query&#39; to look in the content</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">wf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="k">for</span> <span class="n">wf</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;workflows&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">wf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">workflow_name</span><span class="p">]</span></div>
</div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Lifebit AI
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=8d563738"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>